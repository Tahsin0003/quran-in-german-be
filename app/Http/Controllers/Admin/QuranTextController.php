<?php

namespace App\Http\Controllers\Admin;
use Illuminate\Pagination\Paginator;
use App\Http\Controllers\Controller;
use Illuminate\Support\Facades\DB;
use Illuminate\Http\Request;
use App\Models\QuranText;

class QuranTextController extends Controller
{
    public function getAllSura(Request $request)
    {
        $currentPage = ($request->page == 0) ? 1 : $request->page;
        Paginator::currentPageResolver(function () use ($currentPage) {
            return $currentPage;
        });
        $perPage = $request->limit ?? 10;
        $page = $request->page ?? 1;
        $suraNumber = $request->suraNumber ?? 1;
        // Fetch all rows ordered by sura and aya
        $query = QuranText::where('sura', $suraNumber)->orderBy('aya');
        $ayas = $query->paginate($request->limit ?? 10);

        // Optionally convert aya numbers to Arabic-Indic and combine text
        $sura = $ayas->getCollection()->map(function($aya) {
            $arabicNumber = $this->convertToArabicNumber($aya->aya);
            return trim($aya->text) . ' ' . $arabicNumber;
        })->implode(' ');

        return response()->json([
            'success' => true,
            'message' => 'Sura retrive successfully.',
            'data' => [
                'sura' => $sura,
                'current_page' => $ayas->currentPage(),
                'last_page' => $ayas->lastPage(),
                'per_page' => $ayas->perPage(),
                'total' => $ayas->total()
            ]
        ]);

        // $quranText = QuranText::orderBy('sura')
        //     ->orderBy('aya')
        //     ->get();

        // Group by sura
        // $grouped = $quranText->groupBy('sura')->map(function ($ayas, $sura) {
        //     return [
        //         'sura' => (int)$sura,
        //         'ayas' => $ayas->map(function ($aya) {
        //             return [
        //                 'index' => $aya->index,
        //                 'aya' => $aya->aya,
        //                 'text' => $aya->text,
        //             ];
        //         })->values()
        //     ];
        // })->values();
        // $suras = [
        //     'الفاتحة',
        //     'البقرة',
        //     'آل عمران',
        //     'النساء',
        //     'المائدة',
        //     'الأنعام',
        //     'الأعراف',
        //     'الأنفال',
        //     'التوبة',
        //     'يونس',
        //     'هود',
        //     'يوسف',
        //     'الرعد',
        //     'إبراهيم',
        //     'الحجر',
        //     'النحل',
        //     'الإسراء',
        //     'الكهف',
        //     'مريم',
        //     'طه',
        //     'الأنبياء',
        //     'الحج',
        //     'المؤمنون',
        //     'النور',
        //     'الفرقان',
        //     'الشعراء',
        //     'النمل',
        //     'القصص',
        //     'العنكبوت',
        //     'الروم',
        //     'لقمان',
        //     'السجدة',
        //     'الأحزاب',
        //     'سبإ',
        //     'فاطر',
        //     'يس',
        //     'الصافات',
        //     'ص',
        //     'الزمر',
        //     'غافر',
        //     'فصلت',
        //     'الشورى',
        //     'الزخرف',
        //     'الدخان',
        //     'الجاثية',
        //     'الأحقاف',
        //     'محمد',
        //     'الفتح',
        //     'الحجرات',
        //     'ق',
        //     'الذاريات',
        //     'الطور',
        //     'النجم',
        //     'القمر',
        //     'الرحمن',
        //     'الواقعة',
        //     'الحديد',
        //     'المجادلة',
        //     'الحشر',
        //     'الممتحنة',
        //     'الصف',
        //     'الجمعة',
        //     'المنافقون',
        //     'التغابن',
        //     'الطلاق',
        //     'التحريم',
        //     'الملك',
        //     'القلم',
        //     'الحاقة',
        //     'المعارج',
        //     'نوح',
        //     'الجن',
        //     'المزمل',
        //     'المدثر',
        //     'القيامة',
        //     'الإنسان',
        //     'المرسلات',
        //     'النبإ',
        //     'النازعات',
        //     'عبس',
        //     'التكوير',
        //     'الإنفطار',
        //     'المطففين',
        //     'الإنشقاق',
        //     'البروج',
        //     'الطارق',
        //     'الأعلى',
        //     'الغاشية',
        //     'الفجر',
        //     'البلد',
        //     'الشمس',
        //     'الليل',
        //     'الضحى',
        //     'الشرح',
        //     'التين',
        //     'العلق',
        //     'القدر',
        //     'البينة',
        //     'الزلزلة',
        //     'العاديات',
        //     'القارعة',
        //     'التكاثر',
        //     'العصر',
        //     'الهمزة',
        //     'الفيل',
        //     'قريش',
        //     'الماعون',
        //     'الكوثر',
        //     'الكافرون',
        //     'النصر',
        //     'المسد',
        //     'الإخلاص',
        //     'الفلق',
        //     'الناس'
        // ];
        // $suras = [
        //     ['الفاتحة', 7],
        //     ['البقرة', 286],
        //     ['آل عمران', 200],
        //     ['النساء', 176],
        //     ['المائدة', 120],
        //     ['الأنعام', 165],
        //     ['الأعراف', 206],
        //     ['الأنفال', 75],
        //     ['التوبة', 129],
        //     ['يونس', 109],
        //     ['هود', 123],
        //     ['يوسف', 111],
        //     ['الرعد', 43],
        //     ['إبراهيم', 52],
        //     ['الحجر', 99],
        //     ['النحل', 128],
        //     ['الإسراء', 111],
        //     ['الكهف', 110],
        //     ['مريم', 98],
        //     ['طه', 135],
        //     ['الأنبياء', 112],
        //     ['الحج', 78],
        //     ['المؤمنون', 118],
        //     ['النور', 64],
        //     ['الفرقان', 77],
        //     ['الشعراء', 227],
        //     ['النمل', 93],
        //     ['القصص', 88],
        //     ['العنكبوت', 69],
        //     ['الروم', 60],
        //     ['لقمان', 34],
        //     ['السجدة', 30],
        //     ['الأحزاب', 73],
        //     ['سبإ', 54],
        //     ['فاطر', 45],
        //     ['يس', 83],
        //     ['الصافات', 182],
        //     ['ص', 88],
        //     ['الزمر', 75],
        //     ['غافر', 85],
        //     ['فصلت', 54],
        //     ['الشورى', 53],
        //     ['الزخرف', 89],
        //     ['الدخان', 59],
        //     ['الجاثية', 37],
        //     ['الأحقاف', 35],
        //     ['محمد', 38],
        //     ['الفتح', 29],
        //     ['الحجرات', 18],
        //     ['ق', 45],
        //     ['الذاريات', 60],
        //     ['الطور', 49],
        //     ['النجم', 62],
        //     ['القمر', 55],
        //     ['الرحمن', 78],
        //     ['الواقعة', 96],
        //     ['الحديد', 29],
        //     ['المجادلة', 22],
        //     ['الحشر', 24],
        //     ['الممتحنة', 13],
        //     ['الصف', 14],
        //     ['الجمعة', 11],
        //     ['المنافقون', 11],
        //     ['التغابن', 18],
        //     ['الطلاق', 12],
        //     ['التحريم', 12],
        //     ['الملك', 30],
        //     ['القلم', 52],
        //     ['الحاقة', 52],
        //     ['المعارج', 44],
        //     ['نوح', 28],
        //     ['الجن', 28],
        //     ['المزمل', 20],
        //     ['المدثر', 56],
        //     ['القيامة', 40],
        //     ['الإنسان', 31],
        //     ['المرسلات', 50],
        //     ['النبإ', 40],
        //     ['النازعات', 46],
        //     ['عبس', 42],
        //     ['التكوير', 29],
        //     ['الإنفطار', 19],
        //     ['المطففين', 36],
        //     ['الإنشقاق', 25],
        //     ['البروج', 22],
        //     ['الطارق', 17],
        //     ['الأعلى', 19],
        //     ['الغاشية', 26],
        //     ['الفجر', 30],
        //     ['البلد', 20],
        //     ['الشمس', 15],
        //     ['الليل', 21],
        //     ['الضحى', 11],
        //     ['الشرح', 8],
        //     ['التين', 8],
        //     ['العلق', 19],
        //     ['القدر', 5],
        //     ['البينة', 8],
        //     ['الزلزلة', 8],
        //     ['العاديات', 11],
        //     ['القارعة', 11],
        //     ['التكاثر', 8],
        //     ['العصر', 3],
        //     ['الهمزة', 9],
        //     ['الفيل', 5],
        //     ['قريش', 4],
        //     ['الماعون', 7],
        //     ['الكوثر', 3],
        //     ['الكافرون', 6],
        //     ['النصر', 3],
        //     ['المسد', 5],
        //     ['الإخلاص', 4],
        //     ['الفلق', 5],
        //     ['الناس', 6],
        // ];

        // foreach ($suras as $index => $name_ar) {
        //     DB::table('suras')->insert([
        //         'sura_number' => $index + 1,
        //         'arabic_name' => $name_ar,
        //         // 'name_en' => null, // you can fill later
        //         // 'total_ayas' => 0, // update later
        //         // 'revelation_type' => null, // Makki/Madani update later
        //         'created_at' => now(),
        //         'updated_at' => now(),
        //     ]);
        // }

        // foreach ($suras as $index => [$name_ar, $total_ayas]) {
        //     DB::table('suras')->insert([
        //         'sura_number' => $index + 1,
        //         'arabic_name' => $name_ar,
        //         'total_ayas' => $total_ayas,
        //         'revelation_type' => null,
        //         'created_at' => now(),
        //         'updated_at' => now(),
        //     ]);
        // }
        // return response()->json($grouped);
    }

    private function convertToArabicNumber($number)
    {
        $western = ['0','1','2','3','4','5','6','7','8','9'];
        $arabic = ['٠','١','٢','٣','٤','٥','٦','٧','٨','٩'];

        return str_replace($western, $arabic, $number);
    }
}
